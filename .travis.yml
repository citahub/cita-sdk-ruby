---
sudo: false
language: ruby
cache: bundler
rvm:
  - 2.4.5
  - 2.5.3
  - 2.6.5
  # FIXME: gem google-protobuf is not working with Ruby 2.7.0, ref: https://github.com/protocolbuffers/protobuf/issues/7070
  # - 2.7.0
before_install: gem install bundler
install:
  - cd secp256k1 && ./autogen.sh && ./configure --enable-module-recovery --enable-experimental --enable-module-ecdh && make && sudo make install && cd ..
  - bundle install
script:
  - bundle exec rake

after_success:
  - bash <(curl -s https://codecov.io/bash)

# automatically release Ruby gem to RubyGems after a successful build with `git push --tags`
# refs: https://docs.travis-ci.com/user/deployment/rubygems/
# 1. how to get your api_key: https://rubygems.org/profile/edit
# 2. install `travis` cli: $ gem install travis
# 3. get encrypted api_key secure: $ travis setup rubygems
# below is generated by travis gem:
deploy:
  provider: rubygems
  api_key:
    secure: qEW15uLo0DVTRAZOkAY035aoPbjHalZhPB3/dEFvBYcnru8gS1Vco3pZrBlk/i5j8LGRs/zq1XSe4u+savuzPcMDlmugLhj0wIvfcrzSm9DiQ6Tej44lYXLgqNrAkXo8sc1jX92vZ7Kp8wae+xzgRD9wckzbrfJd7fFGyPzv1SFpUN0lT+XHvsQuKRP89qIvSykKn26ubnVotUSI9HmDx/fvsNJ23MAgcO0WZut1vPNPLQiVHhIOkHhjjeWrpCUx7bxaxLx41d3zaH61YtiZ8deNvQmsPyx0wndnxxeuOfg3x9McGKTkSHihyv1qAPI8ZxAUPdVjlcl+PjrQdHYymleh/EhjLbIv2XJHnVA7MnrdjjtfDnDSHB0lgaWd70A57+HkuGtX4cwzvBXWJXAuys+mX8s2i98UtcGEpF9AVRGLQ3f9z82i02CVR6YhYQ1sZQDNeS5RNair/YdLfEsbljD3bkU3dSaFxCr64Ii1Z20+QmgMQYx8doTQMzGPFNreVAweL77ZXHliO33tYrEtc1hUHKrh9qQVsipb2A/7x3NN22+zjKDGNGt+B6Q6flClbljH00sKZezjUzGh3NkmABnJ4m0yd4bFmdvUz76x2teugENjxSudJvoeyIJUGj3ZYK2lYNrdURn1OMZUT5YgZc9WmZyEx/8FNUfQLRvYtmY=
  gem: cita-sdk-ruby
  on:
    tags: true
    repo: citahub/cita-sdk-ruby
